---
import type { ImageMetadata } from 'astro';
import type { HTMLAttributes } from 'astro/types';
import { Picture } from 'astro:assets';
import CardButton from './CardButton.astro';
import CardContent from './CardContent.astro';

export interface Slide {
  image: Promise<{ default: ImageMetadata }>;
  country: string;
  title: string;
  description: string;
  price: string;
}

interface Props extends Pick<HTMLAttributes<'div'>, 'class'> {
  slides: Slide[];
}

const { slides, class: className, ...rest } = Astro.props;
---

<div class:list={[className, 'splide']} data-component='slider' {...rest}>
  <div class='splide__track slider'>
    <ul class='splide__list'>
      {
        slides.map(({ image, title, price, description, country }) => (
          <div class='splide__slide slider__slide slide'>
            <div class='slide__inner'>
              <div class='slide__image'>
                <Picture inferSize layout='constrained' formats={['avif', 'webp']} src={image} alt='image' />
              </div>
              <CardContent title={country} subtitle={title} description={description}>
                <CardButton text='опт' price={price} />
              </CardContent>
            </div>
          </div>
        ))
      }
    </ul>
  </div>
</div>

<style lang='scss'>
  .slider {
    @include media('lg') {
      @include border(1px, var(--light-2));
      border-radius: 8px;
    }

    @include media('xl') {
      border-radius: 12px;
    }
  }

  .slide {
    border-top: 1px solid var(--light-2);
    border-bottom: 1px solid var(--light-2);
    padding: 8px 0;

    @include adaptiveValue('width', 187, 117, $adaptive-sm, $adaptive-md);

    @include media('lg') {
      @include adaptiveValue('width', 201, 187, $adaptive-sm, $adaptive-md);
      border: 0;
    }

    @include media('xl') {
      @include adaptiveValue('width', 229, 201, $adaptive-xl, $adaptive-xxl);
    }

    &__inner {
      border-right: 1px solid var(--light-2);
      border-left: 1px solid var(--light-2);

      @include media('lg') {
        border-left: 0;
      }
    }

    &:first-child {
      border-top-left-radius: 12px;
      border-bottom-left-radius: 12px;
    }

    &:last-child {
      border-top-right-radius: 12px;
      border-bottom-right-radius: 12px;
    }

    &__image {
      position: relative;
      aspect-ratio: 117 / 144;
      margin-bottom: 6px;

      @include media('md') {
        aspect-ratio: 187 / 288;
      }

      @include media('lg') {
        aspect-ratio: 201 / 288;
      }

      @include media('xl') {
        aspect-ratio: 229 / 328;
      }

      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
    }
  }
</style>

<script>
  import Splide from '@splidejs/splide';

  document.querySelectorAll<HTMLDivElement>("[data-component='slider']").forEach((slider) => {
    new Splide(slider, {
      type: 'loop',
      autoWidth: true,
      arrows: false,
      pagination: false,
      clones: 10,
    }).mount();
  });
</script>
