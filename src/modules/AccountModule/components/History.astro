---
import type { HTMLAttributes } from 'astro/types';

export interface IHistoryCard {
  title: string;
  subtitle: string;
  price: string;
  countTop: string;
  countBottom: string;
  status: 'in_progress' | 'done';
}

const statusDictionary = {
  in_progress: 'Доставляется',
  done: 'завершен',
};

interface Props extends Pick<HTMLAttributes<'div'>, 'class'> {
  cards: IHistoryCard[];
}

const { cards, class: className, ...rest } = Astro.props;
---

<div class:list={['history', className]} {...rest}>
  <div class='history__top'>
    <h2 class='history__title title-block'>История заказов</h2>
    <p class='history__subtitle subtitle-block'>Текст комментария от нейросети для расшифровки</p>
  </div>
  <div class='history__slider splide' data-component='history-slider'>
    <div class='history__slider-track splide__track'>
      <div class='history__slider-list splide__list'>
        {
          cards.map(({ title, subtitle, price, countTop, countBottom, status }) => (
            <div class='history__slide card-history splide__slide'>
              <div class='card-history__header'>
                <div class='card-history__title'>{title}</div>
                <div class='card-history__subtitle'>{subtitle}</div>
              </div>
              <div class='card-history__sep card-history__sep_sm' />
              <div class='card-history__content'>
                <div class='card-history__price'>
                  <span>{price}</span>
                  РУБ
                </div>
                <div class='card-history__count-wrapper'>
                  <div class='card-history__count-row'>{countTop}</div>
                  <div class='card-history__count-row'>{countBottom}</div>
                </div>
              </div>
              <div class='card-history__sep card-history__sep_md' />
              <div class='card-history__footer'>
                <div class:list={['card-history__status', status]}>{statusDictionary[status]}</div>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</div>

<style lang='scss'>
  .history {
    &__top {
      margin-bottom: 8px;
      text-align: left;
    }

    &__title {
      @include media('lg') {
        text-align: left;
      }
    }

    &__subtitle {
      @include media('lg') {
        text-align: left;
      }
    }

    &__slider {
    }

    &__slider-track {
      overflow: visible;

      @include media('lg') {
        overflow: hidden;
      }
    }

    &__slider-list {
    }

    &__slide {
    }
  }

  .card-history {
    width: 108px;
    padding: 16px 8px 10px;
    border-radius: 8px;
    overflow: hidden;
    background-color: var(--light);
    @include border(1px, #d5cbbc);

    @include media('md') {
      width: calc((100vw / 4 - 4px * 3));
    }

    @include media('lg') {
      padding: 20px 12px 8px;
      width: calc((100vw / 4 - 4px * 3 + 1px));
    }

    &__header {
    }

    &__title {
      font-weight: 900;
      font-size: 16px;
      text-transform: uppercase;
      color: var(--secondary);
      margin-bottom: 3px;
      text-align: center;

      @include media('lg') {
        font-size: 24px;
      }
    }

    &__subtitle {
      font-weight: 800;
      font-size: 12px;
      text-transform: uppercase;
      color: var(--primary);
      text-align: center;

      @include media('lg') {
        font-size: 16px;
      }
    }

    &__sep {
      height: 1px;
      background-color: #a9987a66;

      &_sm {
        width: 16px;
        margin: 8px auto;
      }

      &_md {
        width: 100%;
        margin: 12px auto 8px;

        @include media('lg') {
          margin: 24px auto 8px;
        }
      }
    }

    &__content {
      margin-bottom: 4px;
    }

    &__price {
      text-align: center;
      font-weight: 900;
      font-style: italic;
      font-size: 10px;
      text-transform: uppercase;
      color: var(--secondary);

      @include media('lg') {
        font-size: 18px;
      }

      span {
        font-size: 16px;

        @include media('lg') {
          font-size: 24px;
        }
      }
    }

    &__count-wrapper {
      text-align: center;
      display: flex;
      flex-direction: column;

      font-weight: 600;
      font-size: 10px;
      text-transform: uppercase;
      color: var(--primary);

      @include media('lg') {
        flex-direction: row;
        justify-content: center;
        font-size: 16px;
        gap: 4px;
      }
    }

    &__count-row {
    }

    &__footer {
    }

    &__status {
      text-align: center;
      font-weight: 800;
      font-size: 12px;
      text-transform: uppercase;

      @include media('lg') {
        font-size: 16px;
      }

      &.in_progress {
        color: var(--secondary);
      }

      &.done {
        color: var(--primary);
      }
    }
  }
</style>

<script>
  import Splide from '@splidejs/splide';

  const slider = document.querySelector<HTMLDivElement>("[data-component='history-slider']");
  if (slider) {
    new Splide(slider, {
      pagination: false,
      arrows: false,
      gap: 4,
      autoWidth: true,
    }).mount();
  }
</script>
