---
import CustomImage from '@/components/shared/CustomImage.astro';
import { Icon } from 'astro-icon/components';
import type { HTMLAttributes } from 'astro/types';

type Props = Pick<HTMLAttributes<'div'>, 'class'>;

const { class: className, ...rest } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/img/detail/*.{jpeg,jpg,png,gif}');

const items: string[] = [
  '/src/assets/img/detail/gallery-image-01.png',
  '/src/assets/img/detail/gallery-image-02.png',
  '/src/assets/img/detail/gallery-image-03.png',
  '/src/assets/img/detail/gallery-image-04.png',
];
---

<div class:list={[className]} {...rest}>
  <div class='gallery'>
    <div class='gallery__items'>
      {
        items.map((img) => (
          <div class='gallery__item'>
            <div class='gallery__image'>
              <CustomImage src={images[img]()} alt="'img" />
            </div>
          </div>
        ))
      }
    </div>
    <div class='gallery__link-wrapper'>
      <a href='#' class='gallery__link'>
        <span>Показать еще 8 фото</span>
        <div class='gallery__link-icon'>
          <Icon name='arrow-down' />
        </div>
      </a>
    </div>
  </div>
  <div class='splide gallery-slider' data-gallery-slider>
    <div class='splide__track'>
      <ul class='splide__list'>
        {
          items.map((img) => (
            <li class='splide__slide gallery-slider__slide'>
              <div class='gallery-slider__image'>
                <CustomImage src={images[img]()} alt='image' />
              </div>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</div>

<style lang='scss'>
  .gallery {
    display: none;

    @include media('lg') {
      display: block;
    }

    &__items {
      display: grid;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 8px;
    }

    &__item {
      width: 100%;
      aspect-ratio: 463 / 688;
    }

    &__link-wrapper {
      padding: 8px;
      display: flex;
      justify-content: center;
      align-items: center;

      @include media('xl') {
        padding: 12px;
      }
    }

    &__link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;

      font-weight: 800;
      font-size: 13px;
      text-transform: uppercase;
      color: var(--secondary);

      @include media('xl') {
        font-size: 16px;
        gap: 8px;
      }
    }

    &__link-icon {
      display: flex;
      align-items: center;
      justify-content: center;

      width: 14px;
      height: 14px;
      border-radius: 100%;
      background-color: var(--light);

      @include media('xl') {
        width: 20px;
        height: 20px;

        svg {
          width: 8px;
          height: 6px;
        }
      }

      svg {
        width: 6px;
        height: 4px;
        color: var(--secondary);
      }
    }

    &__image {
      position: relative;
      width: 100%;
      height: 100%;

      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
  }

  .splide {
    &__track {
    }

    &__list {
    }

    &__slide {
    }
  }

  .gallery-slider {
    @include media('lg') {
      display: none;
    }

    &__slide {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 56px;
    }

    &__image {
      position: relative;
      aspect-ratio: 278 / 416;
      width: 100%;

      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
  }
</style>

<script>
  import Splide from '@splidejs/splide';

  const gallerySlider = document.querySelector<HTMLDivElement>('[data-gallery-slider]');
  if (gallerySlider) {
    new Splide(gallerySlider, { type: 'loop', arrows: false, pagination: false, perPage: 1 }).mount();
  }
</script>
